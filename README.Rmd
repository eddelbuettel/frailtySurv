---
output:
  md_document:
    variant: markdown_github
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

## frailtyr

```{r, cache = FALSE, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "figures/"
)
```

frailtyr is an R package for simulating and fitting semiparametric shared frailty models.

## Installation

To get started, you can install the package from github using `devtools`.

```{r eval = F}
library(devtools)
install_github("vmonaco/frailtyr")
```

## Example
The following code shows how to generate data and fit the model.
```{r, echo=TRUE, cache=TRUE}
set.seed(1234)
library(frailtyr)
dat <- genfrail(N=200, K=2, beta=c(log(2),log(3)), 
                frailty="gamma", theta=2,
                censor.rate=0.35,
                Lambda_0=function(t, tau=4.6, C=0.01) (C*t)^tau)

fit <- fitfrail(Surv(time, status) ~ Z1 + Z2 + cluster(family), 
                dat, frailty="gamma")
```
```{r, echo=TRUE}
fit
```

Parameter traces are given by
```{r, message=FALSE, echo=TRUE, fig.height=3, fig.width=8, cache=TRUE}
plot(fit, "trace")
```

The estimated cumulative baseline hazard is given by
```{r, message=FALSE, echo=TRUE, fig.height=3, fig.width=8, cache=TRUE}
plot(fit, "hazard")
```

Note that this takes some time to compute since the cumulative baseline hazard variance is estimated by a weighted bootstrap procedure. These results can be compared to other estimation techniques.
```{r, message=FALSE, echo=TRUE}
library(survival)
library(frailtypack)
```
```{r, echo=TRUE}
coxph(Surv(time, status) ~ Z1 + Z2 + frailty.gamma(family), data=dat)
frailtyPenal(Surv(time, status) ~ Z1 + Z2 + cluster(family), data=dat, n.knots=10, kappa=2)
```

## Clone and build

Instead of installing from github, you can clone and build the project from source. To create a project in RStudio from this repository, you must have both RStudio and git installed.

* In RStudio, go to File -> New Project -> Version Control -> Git
* Name the project (eg. frailtyr), choose location, and specify the Repository URL as `https://github.com/vmonaco/frailtyr`

More information about [RStudio and git](https://support.rstudio.com/hc/en-us/articles/200532077-Version-Control-with-Git-and-SVN)

Also see the chapter in the [R packages book](http://r-pkgs.had.co.nz/git.html)

### Build everything

To load the package (simulate installing and loading with `library(frailty)`):
```{r eval = F}
devtools::load_all()
```
or shortuct: **Ctrl+Shift+L**

Use this command to build a source package (binary = FALSE by default)
```{r eval = F}
devtools::build()
```

Other usefull commands and shortcuts:

- Build and reload everything: **Ctrl+Shift+B**
- Check the package, `devtools::check()`: **Ctrl+Shift+E**
- Run all tests, `devtools::test()`: **Ctrl+Shift+T**

### Build vignettes

Build the vignettes with the command:
```{r eval = F}
devtools::build_vignettes()
```

Compiled vignettes will reside in `inst/doc`. In particular, see frailtyr.pdf

### Run tests

frailtyr uses the `testthat` library for tests. Test files are all located in `tests/testthat`. To run all tests, use the command `devtools::test()` or shortcut **Ctrl+Shift+T**

### git pull

Use RStudio to pull the latest code if you've already cloned the repository. In the "git" pane, look for the Pull button. You can also view the commit history from there and see the diff between modified files, if any.